---
alwaysApply: true
---

# é¡¹ç›®åŸºæœ¬ä¿¡æ¯

è¿™æ˜¯ä¸€ä¸ªå•†ä¸šçº§çš„æ¸¸æˆå·¥ç¨‹ï¼ŒåŒ…å«å‰ç«¯ä»£ç ã€åç«¯ä»£ç ï¼Œå‰åç«¯éƒ½æ˜¯ä½¿ç”¨çš„C#ï¼Œæ‰€ä»¥æœ‰ä¸€éƒ¨åˆ†ä»£ç æ˜¯å…±äº«çš„ï¼ˆåœ¨Shareæ–‡ä»¶å¤¹é‡Œé¢ï¼‰ã€‚
- å®¢æˆ·ç«¯ä»£ç æ ¹ç›®å½•ï¼šG:\UnityProject\ETFramework\Unity\Assets\Scripts
- æœåŠ¡ç«¯ä»£ç æ ¹ç›®å½•ï¼šG:\UnityProject\ETFramework\DotNetï¼Œé‡Œé¢åŒ…å«å¤šä¸ª.neté¡¹ç›®
- çº¿ç¨‹æ¨¡å‹ï¼šUnityå®¢æˆ·ç«¯ä½¿ç”¨å•çº¿ç¨‹ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨å¤šçº¿ç¨‹

é‡è¦ç›®å½•è¯´æ˜ï¼š
- Scripts/Coreï¼šæ¡†æ¶çš„æ ¸å¿ƒä»£ç æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±ç”¨çš„
- Scripts/Modelï¼šå®šä¹‰æ•°æ®å’Œç›¸å…³å­—æ®µå±æ€§çš„åœ°æ–¹ï¼Œä¸åŒ…å«Unityä»£ç ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±äº«
- Scripts/Hotfixï¼šModelä¸­å®šä¹‰æ•°æ®çš„å…·ä½“å®ç°é€»è¾‘ï¼Œä¸åŒ…å«Unityä»£ç ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±äº«
- æ¶ˆæ¯åè®®ç›®å½•ï¼šUnity\Assets\Scripts\Model\Core\Share\Proto\ClientServerï¼ˆåŸºäºæ ¹ç›®å½•G:\UnityProject\ETFrameworkï¼‰ï¼Œè¿™æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±äº«çš„ä»£ç 

# å·¥ä½œæµç¨‹è§„èŒƒ

## ä¿®æ”¹ä»£ç å‰
- æ£€æŸ¥å·¥ä½œç›®å½•æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•ä¸‹å·¥ä½œ
- æŸ¥æ‰¾ä»£ç çš„ç›¸å…³å¼•ç”¨ï¼Œç†è§£å®Œæ•´çš„è°ƒç”¨é“¾å’Œä¾èµ–å…³ç³»
- ä»”ç»†æ€è€ƒï¼Œå¯ä»¥å»¶é•¿æ€è€ƒæ—¶é—´ï¼Œä¸€æ¬¡æ€§ç»™å‡ºæœ€å¥½çš„ç»“æœ

## ä¿®æ”¹ä»£ç æ—¶
- ä¸è¦ç¡¬ç¼–ç æ•°æ®ï¼Œå¯ä»¥åœ¨æ¥å£ä¸­æš‚æ—¶æä¾›å‡æ•°æ®ï¼ˆè¿™æ˜¯æ­£å¼å·¥ç¨‹ï¼Œä¸æ˜¯demoï¼‰
- å°½é‡ä¿è¯ä»£ç å¹²å‡€æ•´æ´ï¼Œåœ¨ä¿è¯æ€§èƒ½å’Œé€»è¾‘æ­£ç¡®çš„å‰æä¸‹ä¿®æ”¹
- æ³¨æ„ä»£ç é£æ ¼ä¸€è‡´æ€§ï¼Œä¿æŒä¸ç°æœ‰ä»£ç é£æ ¼ä¸€è‡´
- é¿å…ä»£ç å†—ä½™ï¼Œå§‹ç»ˆä¿æŒç®€æ´ï¼Œé«˜æ•ˆï¼Œæ˜“ç»´æŠ¤

## ä¿®æ”¹ä»£ç å
- æ·»åŠ å¥½æ³¨é‡Šå¹¶ä¿å­˜åˆ°æœ¬åœ°ä»“åº“ï¼Œä»¥ä¾¿å›æ»š
- æ£€æŸ¥æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯å’Œè­¦å‘Š
- éªŒè¯ä¿®æ”¹æ˜¯å¦å½±å“å…¶ä»–åŠŸèƒ½

# æŠ€æœ¯æ ˆå’Œè§„èŒƒ

## æ¶ˆæ¯åè®®
- åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä½¿ç”¨Ninoåº“ï¼ŒGithubåœ°å€ï¼šhttps://github.com/JasonXuDeveloper/Nino
- æ¶ˆæ¯åè®®å‘½åè§„åˆ™ï¼šæ¶ˆæ¯åè®®æ˜¯Main2NetClient_Loginï¼Œæ¶ˆæ¯å‘é€åï¼Œæ¶ˆæ¯çš„æ¥æ”¶çš„åœ°æ–¹æ˜¯Main2NetClient_LoginHandler
- æ¶ˆæ¯åè®®å®šä¹‰åœ¨Modelä¸­ï¼ŒHandlerå®ç°åœ¨Hotfixä¸­

## æ¶ˆæ¯ç³»ç»Ÿæ¶æ„ï¼ˆæ ¸å¿ƒè¦ç‚¹ï¼‰

### ä¸¤å¥—ç‹¬ç«‹çš„æ¶ˆæ¯ç³»ç»Ÿ
ETæ¡†æ¶ä½¿ç”¨**ä¸¤å¥—ç‹¬ç«‹çš„æ¶ˆæ¯ç³»ç»Ÿ**ï¼Œç”¨é€”ä¸åŒï¼Œä¸èƒ½æ··ç”¨ï¼š

1. **Actoræ¶ˆæ¯ç³»ç»Ÿï¼ˆè¿›ç¨‹å†…é€šä¿¡ï¼‰**
   - ç”¨é€”ï¼šåŒä¸€è¿›ç¨‹å†…ä¸åŒFiberä¹‹é—´çš„é€šä¿¡
   - æ¥å£ï¼š`IRequest`/`IResponse`ï¼ˆRPCï¼‰ã€`IMessage`ï¼ˆå•å‘æ¶ˆæ¯ï¼‰
   - ç»„ä»¶ï¼š`ProcessInnerSender`ã€`MailBoxComponent`ã€`MessageQueue`
   - ç‰¹ç‚¹ï¼šè¿›ç¨‹å†…ã€FIFOé˜Ÿåˆ—ã€æ”¯æŒRPCã€é«˜æ€§èƒ½
   - ä½¿ç”¨åœºæ™¯ï¼šMain Fiber ä¸ NetClient Fiber é€šä¿¡ã€æœåŠ¡ç«¯å†…éƒ¨é€šä¿¡

2. **Sessionæ¶ˆæ¯ç³»ç»Ÿï¼ˆç½‘ç»œé€šä¿¡ï¼‰**
   - ç”¨é€”ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ç½‘ç»œé€šä¿¡
   - æ¥å£ï¼š`ISessionRequest`/`ISessionResponse`ï¼ˆRPCï¼‰ã€`ISessionMessage`ï¼ˆå•å‘æ¶ˆæ¯ï¼‰
   - ç»„ä»¶ï¼š`Session`ã€`NetComponent`ã€`Router`
   - ç‰¹ç‚¹ï¼šè·¨è¿›ç¨‹ã€åŸºäºKCP/TCPã€æ”¯æŒRPCã€é€šè¿‡Routerè½¬å‘
   - ä½¿ç”¨åœºæ™¯ï¼šå®¢æˆ·ç«¯ç™»å½•ã€æ¸¸æˆé€»è¾‘é€šä¿¡

### MailBoxComponent å·¥ä½œåŸç†
- **ä»»ä½•Entityéƒ½å¯ä»¥æˆä¸ºActor**ï¼šåªéœ€æ·»åŠ `MailBoxComponent`ç»„ä»¶
- **Entityè‡ªå¸¦ActorId**ï¼šé€šè¿‡`entity.GetActorId()`è·å–ï¼ŒåŒ…å«Processã€Fiberã€InstanceId
- **æ¶ˆæ¯æ¥æ”¶æµç¨‹**ï¼š
  1. æ¶ˆæ¯é€šè¿‡`ProcessInnerSender.Send/Call`å‘é€åˆ°ç›®æ ‡Actor
  2. æ¶ˆæ¯è¿›å…¥`MessageQueue`ï¼ˆæŒ‰Fiberåˆ†ç»„ï¼‰
  3. ç›®æ ‡Fiberçš„`ProcessInnerSender.Update`æ¯å¸§æ‰¹é‡å–å‡ºæ¶ˆæ¯ï¼ˆæœ€å¤š1000æ¡ï¼‰
  4. æ ¹æ®`ActorId.InstanceId`æŸ¥æ‰¾å¯¹åº”çš„`MailBoxComponent`ï¼ˆå­˜å‚¨åœ¨`Fiber.Mailboxes`ä¸­ï¼‰
  5. `MailBoxComponent.Add`è§¦å‘`EventSystem.Invoke`ï¼Œæ ¹æ®`MailBoxType`åˆ†å‘
  6. `MessageHandler`å¤„ç†æ¶ˆæ¯ï¼Œä¼ å…¥çš„entityæ˜¯`MailBoxComponent.Parent`ï¼ˆå³æ·»åŠ äº†MailBoxComponentçš„Entityï¼‰
- **MailBoxComponentå­˜å‚¨**ï¼šå­˜å‚¨åœ¨`Fiber.Mailboxes`ä¸­ï¼Œkeyæ˜¯`MailBoxComponent.Parent.InstanceId`ï¼Œvalueæ˜¯MailBoxComponentæœ¬èº«ï¼ˆEntityRef<Entity>ï¼‰
- **MailBoxType**ï¼šå†³å®šæ¶ˆæ¯åˆ†å‘æ–¹å¼ï¼Œç›®å‰æœ‰`UnOrderedMessage`ï¼ˆæ— åºæ¶ˆæ¯ï¼‰ç­‰

### Actoræ¶ˆæ¯å‘é€è¦ç‚¹
- **è·å–ActorId**ï¼šä½¿ç”¨`entity.GetActorId()`è·å–Entityçš„ActorId
- **å‘é€æ¶ˆæ¯**ï¼šé€šè¿‡`ProcessInnerSender.Send(actorId, message)`æˆ–`ProcessInnerSender.Call(actorId, request)`
- **æ¶ˆæ¯è·¯ç”±**ï¼šæ¶ˆæ¯æ ¹æ®`ActorId.Address.Fiber`è·¯ç”±åˆ°ç›®æ ‡Fiberçš„æ¶ˆæ¯é˜Ÿåˆ—
- **æ¶ˆæ¯æŸ¥æ‰¾**ï¼šæ ¹æ®`ActorId.InstanceId`åœ¨`Fiber.Mailboxes`ä¸­æŸ¥æ‰¾MailBoxComponent
- **RPCå“åº”**ï¼šé€šè¿‡`ProcessInnerSender.Reply`å›å¤ï¼Œè‡ªåŠ¨åŒ¹é…`requestCallback`ä¸­çš„ç­‰å¾…è€…

### Sessionæ¶ˆæ¯å‘é€è¦ç‚¹
- **Sessionåˆ›å»º**ï¼šé€šè¿‡`NetComponent.CreateRouterSession`åˆ›å»ºè·¯ç”±Session
- **å‘é€æ¶ˆæ¯**ï¼šé€šè¿‡`Session.Call(request)`ï¼ˆRPCï¼‰æˆ–`Session.Send(message)`ï¼ˆå•å‘ï¼‰
- **æ¶ˆæ¯åºåˆ—åŒ–**ï¼šä½¿ç”¨`MessageSerializeHelper.ToMemoryBuffer`åºåˆ—åŒ–
- **ç½‘ç»œä¼ è¾“**ï¼šé€šè¿‡KCP/UDPæˆ–TCPä¼ è¾“ï¼Œæ”¯æŒRouterè½¬å‘
- **æ¶ˆæ¯æ¥æ”¶**ï¼šæœåŠ¡ç«¯`NetComponent.OnRead`æ¥æ”¶ï¼Œååºåˆ—åŒ–ååˆ†å‘åˆ°`MessageSessionDispatcher`
- **Handlerè‡ªåŠ¨å›å¤**ï¼š`MessageSessionHandler`è‡ªåŠ¨å¤„ç†RPCå“åº”ï¼Œé€šè¿‡`Session.Send(response)`å›å¤

### æ¶ˆæ¯Handleræ³¨å†Œ
- **Actoræ¶ˆæ¯Handler**ï¼šç»§æ‰¿`MessageHandler<Entity, Request, Response>`ï¼Œé€šè¿‡`MessageDispatcher.Instance.RegisterMessage<HandlerType>(SceneType)`æ³¨å†Œ
- **Sessionæ¶ˆæ¯Handler**ï¼šç»§æ‰¿`MessageSessionHandler<Request, Response>`ï¼Œé€šè¿‡`MessageSessionDispatcher.Instance.RegisterMessageSession<HandlerType>(SceneType)`æ³¨å†Œ
- **æ³¨å†Œä½ç½®**ï¼šHandlerå®ç°åœ¨Hotfixä¸­ï¼Œåœ¨`GameRegister.RegisterMessage()`å’Œ`GameRegister.RegisterMessageSession()`ä¸­æ³¨å†Œ
- **æ³¨å†Œç¤ºä¾‹**ï¼š`MessageDispatcher.Instance.RegisterMessage<A2NetClient_MessageHandler>(SceneType.NetClient)`

### å…³é”®ç»„ä»¶è¯´æ˜
- **ProcessInnerSender**ï¼šæŒ‚è½½åœ¨Sceneä¸Šï¼Œè´Ÿè´£Actoræ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶ï¼ŒUpdateä¸­æ¯å¸§å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—
- **MailBoxComponent**ï¼šæŒ‚è½½åœ¨éœ€è¦æ¥æ”¶Actoræ¶ˆæ¯çš„Entityä¸Šï¼Œè¡¨ç¤ºè¯¥Entityæ˜¯ä¸€ä¸ªActor
- **MessageQueue**ï¼šå…¨å±€å•ä¾‹ï¼ŒæŒ‰Fiberåˆ†ç»„å­˜å‚¨æ¶ˆæ¯ï¼Œæ”¯æŒæ‰¹é‡è·å–
- **Session**ï¼šç½‘ç»œè¿æ¥çš„æŠ½è±¡ï¼Œæ”¯æŒRPCå’Œå•å‘æ¶ˆæ¯
- **NetComponent**ï¼šç½‘ç»œç»„ä»¶ï¼Œç®¡ç†Sessionçš„åˆ›å»ºå’Œæ¶ˆæ¯æ”¶å‘

### æ¶ˆæ¯æµç¨‹æ³¨æ„äº‹é¡¹
- **Actoræ¶ˆæ¯æ˜¯è¿›ç¨‹å†…çš„**ï¼šä¸èƒ½ç”¨äºè·¨è¿›ç¨‹é€šä¿¡ï¼Œè·¨è¿›ç¨‹å¿…é¡»ä½¿ç”¨Session
- **æ¶ˆæ¯é¡ºåº**ï¼šActoræ¶ˆæ¯åœ¨åŒä¸€Fiberå†…ä¿è¯FIFOé¡ºåºï¼Œä½†`UnOrderedMessage`å¯èƒ½ä¸ä¿è¯
- **å¼‚æ­¥å¤„ç†**ï¼š`MailBoxType_UnOrderedMessageHandler`ä½¿ç”¨`NoContext()`ï¼Œä¸ç­‰å¾…å®Œæˆï¼Œæ³¨æ„å¼‚å¸¸å¤„ç†
- **æ¶ˆæ¯è¶…æ—¶**ï¼šActor RPCé»˜è®¤40ç§’è¶…æ—¶ï¼ŒSession RPCéœ€è¦åœ¨è°ƒç”¨æ—¶è®¾ç½®è¶…æ—¶
- **Entityç”Ÿå‘½å‘¨æœŸ**ï¼šç¡®ä¿å‘é€æ¶ˆæ¯æ—¶ç›®æ ‡EntityåŠå…¶MailBoxComponentä»ç„¶å­˜åœ¨

## Actoræ¨¡å‹å’ŒFiber
- Fiberæ˜¯Actoræ¨¡å‹çš„è°ƒåº¦å•ä½ï¼Œæ¯ä¸ªFiberæœ‰è‡ªå·±çš„çº¿ç¨‹æˆ–è°ƒåº¦å™¨
- è·¨Fiberé€šä¿¡å¿…é¡»é€šè¿‡ProcessInnerSenderå‘é€æ¶ˆæ¯ï¼Œä¸èƒ½ç›´æ¥è®¿é—®å…¶ä»–Fiberçš„Entity
- æ¶ˆæ¯é¡ºåºç”±MessageQueueä¿è¯FIFOé¡ºåºï¼Œä¿®æ”¹æ¶ˆæ¯å¤„ç†é€»è¾‘æ—¶è¦æ³¨æ„ä¿æŒæ¶ˆæ¯é¡ºåºï¼Œé¿å…å½±å“å…¶ä»–æ¶ˆæ¯çš„å¤„ç†é¡ºåº
- Fiberåˆ›å»ºåéœ€è¦ç­‰å¾…FiberInitå®Œæˆæ‰èƒ½å‘é€æ¶ˆæ¯ï¼Œæ³¨æ„æ—¶åºé—®é¢˜ï¼Œé¿å…åœ¨Fiberæœªåˆå§‹åŒ–å®Œæˆæ—¶å‘é€æ¶ˆæ¯å¯¼è‡´å¤±è´¥
- MainThreadScheduleråœ¨Unityçš„Update/LateUpdateä¸­è°ƒåº¦ï¼Œæ³¨æ„Unityç”Ÿå‘½å‘¨æœŸçš„å½±å“

## Fiberçº¿ç¨‹æ¨¡å‹å’Œçº¿ç¨‹å®‰å…¨

### Fiberå†…éƒ¨å•çº¿ç¨‹ä¿è¯
- **æ¯ä¸ªFiberå†…éƒ¨æ˜¯å•çº¿ç¨‹çš„**ï¼šåŒä¸€Fiberçš„æ‰€æœ‰Updateã€Timerå›è°ƒã€æ¶ˆæ¯å¤„ç†éƒ½åœ¨åŒä¸€çº¿ç¨‹é¡ºåºæ‰§è¡Œ
- **ä¸åŒFiberå¯èƒ½åœ¨ä¸åŒçº¿ç¨‹**ï¼šæœåŠ¡ç«¯ä½¿ç”¨ThreadScheduleræ—¶ï¼Œæ¯ä¸ªFiberæœ‰ç‹¬ç«‹çº¿ç¨‹
- **ç»„ä»¶å±äºFiber**ï¼šæŒ‚åœ¨Sceneä¸Šçš„ç»„ä»¶ï¼ˆå¦‚TimerComponentã€CoroutineLockComponentï¼‰éƒ½å±äºåŒä¸€Fiber
- **Updateæ‰§è¡Œé¡ºåº**ï¼šFiber.Update â†’ EntitySystem.Publish(UpdateEvent) â†’ æŒ‰æ³¨å†Œé¡ºåºè°ƒç”¨IUpdateç»„ä»¶
- **Timerå›è°ƒåœ¨Fiberçº¿ç¨‹**ï¼šTimerè¶…æ—¶å›è°ƒåœ¨è¯¥Fiberçš„Updateä¸­æ‰§è¡Œï¼Œä¸å…¶ä»–ç»„ä»¶é¡ºåºæ‰§è¡Œ

### è·¨Fiberå¹¶å‘åœºæ™¯
- **ä¸åŒFiberçš„å¯¹è±¡ä¸å…±äº«**ï¼šæ¯ä¸ªFiberæœ‰è‡ªå·±çš„TimerComponentã€CoroutineLockComponentç­‰
- **ThreadSynchronizationContextä¿è¯å®‰å…¨**ï¼šè·¨çº¿ç¨‹è°ƒç”¨é€šè¿‡PostæŠ•é€’åˆ°ç›®æ ‡Fiberçº¿ç¨‹æ‰§è¡Œ
- **é¿å…ç›´æ¥è®¿é—®å…¶ä»–Fiberçš„Entity**ï¼šå¿…é¡»é€šè¿‡æ¶ˆæ¯é€šä¿¡

### çº¿ç¨‹å®‰å…¨ç¼–ç¨‹è§„èŒƒ
- **Fiberå†…ç»„ä»¶**ï¼šé€šå¸¸ä¸éœ€è¦çº¿ç¨‹åŒæ­¥ï¼ˆå•çº¿ç¨‹ä¿è¯ï¼‰
- **å¯èƒ½å¹¶å‘çš„ç‚¹**ï¼š
  - åŒä¸€å¯¹è±¡çš„å¤šä¸ªå›è°ƒï¼ˆå¦‚è¶…æ—¶å’Œæ­£å¸¸å›è°ƒï¼‰å¯èƒ½åœ¨æ—¶åºä¸Šæ¥è¿‘
  - ä½¿ç”¨`Interlocked.Exchange`é˜²æ­¢é‡å¤è°ƒç”¨SetResult/SetException
  - ä½¿ç”¨`Volatile.Read`ç¡®ä¿å†…å­˜å¯è§æ€§
- **å·²çŸ¥å¹¶å‘å®‰å…¨æ¨¡å¼**ï¼š
  - WaitCoroutineLockï¼šä½¿ç”¨Interlocked.ExchangeåŸå­äº¤æ¢tcs
  - CoroutineBlockerï¼šä½¿ç”¨Interlocked.Exchangeé˜²æ­¢é‡å¤SetResult
  - MessageQueueï¼šä½¿ç”¨ConcurrentQueueä¿è¯çº¿ç¨‹å®‰å…¨

## ETTaskå¼‚æ­¥æ¡†æ¶è¦ç‚¹

### ETTask vs C# Task
- **é¿å…ä½¿ç”¨C# Task**ï¼šä¼šå¼•å…¥çº¿ç¨‹æ± ï¼Œä¸Fiberæ¨¡å‹å†²çª
- **ä½¿ç”¨ETTask**ï¼šè½»é‡çº§å¼‚æ­¥ï¼Œæ— çº¿ç¨‹æ± å¼€é”€ï¼Œæ”¯æŒå¯¹è±¡æ± 
- **ETTaskå¯¹è±¡æ± **ï¼šè°¨æ…ä½¿ç”¨ï¼Œawaitåä¸èƒ½å†æ“ä½œETTask
- **SetResultå‰ç½®ç©ºtcs**ï¼šé¿å…å¤šæ¬¡SetResultï¼Œä½¿ç”¨Interlocked.Exchangeæ¨¡å¼

### å¹¶å‘åŸè¯­ä½¿ç”¨
- **Interlocked.Exchange**ï¼šåŸå­äº¤æ¢ï¼Œé˜²æ­¢å¹¶å‘é‡å¤è°ƒç”¨
- **Interlocked.Decrement/Increment**ï¼šåŸå­è®¡æ•°æ“ä½œ
- **Volatile.Read/Write**ï¼šç¡®ä¿å†…å­˜å¯è§æ€§ï¼Œé˜²æ­¢CPUç¼“å­˜é—®é¢˜
- **æ€§èƒ½å½±å“**ï¼šè¿™äº›æ“ä½œå¼€é”€æå°ï¼ˆ~50çº³ç§’ï¼‰ï¼Œåœ¨å¼‚æ­¥ç­‰å¾…åœºæ™¯ä¸­å¯å¿½ç•¥ï¼ˆ<0.01%ï¼‰

### å–æ¶ˆå’Œè¶…æ—¶æœºåˆ¶
- **ETCancellationToken**ï¼šé€šè¿‡å›è°ƒæœºåˆ¶å–æ¶ˆï¼Œä¸æŠ›å¼‚å¸¸
- **Cancelè°ƒç”¨SetResult**ï¼šå–æ¶ˆæ—¶æ­£å¸¸å®ŒæˆTaskï¼Œä¸æ˜¯å¼‚å¸¸å®Œæˆ
- **è¶…æ—¶ä»»åŠ¡ä¼˜åŒ–**ï¼šRPCæ­£å¸¸è¿”å›æ—¶ç«‹å³Cancelè¶…æ—¶ä»»åŠ¡ï¼Œé¿å…èµ„æºå ç”¨
- **è¶…æ—¶æ—¶é—´**ï¼šActor RPCé»˜è®¤4ç§’ï¼Œæ ¹æ®ä¸šåŠ¡è°ƒæ•´

## å¼‚æ­¥æ“ä½œè§„èŒƒ
- ä½¿ç”¨ETTaskè¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œé¿å…ä½¿ç”¨Taskæˆ–Thread
- ä½¿ç”¨awaitæ—¶æ³¨æ„ä¸Šä¸‹æ–‡ï¼Œç¡®ä¿åœ¨æ­£ç¡®çš„Fiberçº¿ç¨‹ä¸­æ‰§è¡Œ
- é•¿æ—¶é—´è¿è¡Œçš„å¼‚æ­¥æ“ä½œè¦è®¾ç½®è¶…æ—¶æœºåˆ¶ï¼Œé¿å…æ— é™ç­‰å¾…å¯¼è‡´æ­»é”
- å¼‚æ­¥æ“ä½œä¸­çš„å¼‚å¸¸è¦æ­£ç¡®ä¼ æ’­ï¼Œé¿å…é™é»˜å¤±è´¥

## èµ„æºç®¡ç†
- å¯¹è±¡æ± ä½¿ç”¨ï¼š
  - EntityObjectPoolï¼šä¸»è¦ç”¨äºEntityçš„åˆ›å»ºå’Œå›æ”¶
  - ObjectPoolï¼šä¸»è¦ç”¨äºéEntityå¯¹è±¡çš„åˆ›å»ºå’Œå›æ”¶
- ä½¿ç”¨ObjectPoolç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯ï¼Œç‰¹åˆ«æ˜¯æ¶ˆæ¯å¯¹è±¡å’Œä¸´æ—¶Entity
- å®ç°IDisposableçš„ç»„ä»¶è¦åœ¨Destroyä¸­æ­£ç¡®é‡Šæ”¾èµ„æºï¼ŒåŒ…æ‹¬ThreadSynchronizationContextã€ç½‘ç»œè¿æ¥ç­‰
- ä½¿ç”¨usingè¯­å¥ç®¡ç†ä¸´æ—¶å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯æ¶ˆæ¯å¯¹è±¡ï¼ˆMessageObjectï¼‰

## å¼‚å¸¸å¤„ç†
- å…³é”®è·¯å¾„è¦æœ‰å¼‚å¸¸æ•è·å’Œæ—¥å¿—è®°å½•ï¼Œé¿å…å¼‚å¸¸å¯¼è‡´ç¨‹åºå´©æºƒ
- å¼‚æ­¥æ“ä½œä¸­è¦ç¡®ä¿å¼‚å¸¸èƒ½æ­£ç¡®ä¼ æ’­ï¼Œé¿å…é™é»˜å¤±è´¥ï¼Œç‰¹åˆ«æ˜¯await FiberManager.Createå’ŒProcessInnerSender.Callç­‰å…³é”®æ“ä½œ
- ç½‘ç»œæ“ä½œå’ŒIOæ“ä½œå¿…é¡»æœ‰è¶…æ—¶å’Œé‡è¯•æœºåˆ¶ï¼Œé¿å…å› ç½‘ç»œé—®é¢˜å¯¼è‡´é•¿æ—¶é—´ç­‰å¾…
- å¼‚å¸¸ä¿¡æ¯è¦åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¾¿äºé—®é¢˜å®šä½

## æ€§èƒ½æ³¨æ„äº‹é¡¹
- é¿å…åœ¨Updateä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œè¯·æ±‚ã€HTTPè¯·æ±‚å’ŒIOæ“ä½œï¼Œè¿™äº›åº”è¯¥åœ¨å¼‚æ­¥æ–¹æ³•ä¸­æ‰§è¡Œ
- æ‰¹é‡æ“ä½œä¼˜å…ˆä½¿ç”¨æ‰¹å¤„ç†ï¼Œå‡å°‘å•æ¬¡è°ƒç”¨å¼€é”€ï¼Œä¾‹å¦‚MessageQueue.Fetchçš„æ‰¹é‡å¤„ç†
- æ³¨æ„æ¶ˆæ¯é˜Ÿåˆ—çš„æ‰¹é‡å¤„ç†é™åˆ¶ï¼Œé¿å…æ¶ˆæ¯å †ç§¯å¯¼è‡´å»¶è¿Ÿï¼Œæ¯å¸§æœ€å¤šå¤„ç†1000æ¡æ¶ˆæ¯
- é¿å…åœ¨æ¸¸æˆå¾ªç¯ä¸­é¢‘ç¹åˆ†é…å†…å­˜ï¼Œç‰¹åˆ«æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ã€é›†åˆæ“ä½œç­‰
- æ³¨æ„Unityçš„GCå½±å“ï¼Œåˆç†ä½¿ç”¨å¯¹è±¡æ± å‡å°‘GCå‹åŠ›

## çº¿ç¨‹å®‰å…¨
- Unityå®¢æˆ·ç«¯æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†Fiberè°ƒåº¦å™¨å¯èƒ½åœ¨ä¸åŒçº¿ç¨‹
- æœåŠ¡ç«¯ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜
- ä¿®æ”¹å‰æ£€æŸ¥æ˜¯å¦æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠConcurrentQueueã€ConcurrentDictionaryç­‰å¹¶å‘é›†åˆçš„æ“ä½œ
- è·¨çº¿ç¨‹è®¿é—®æ•°æ®æ—¶è¦æ³¨æ„åŒæ­¥æœºåˆ¶ï¼Œé¿å…ç«æ€æ¡ä»¶

# ä»£ç å®¡æŸ¥æ£€æŸ¥ç‚¹

## ä¿®æ”¹å‰æ£€æŸ¥
- æ£€æŸ¥æ˜¯å¦æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜
- æ£€æŸ¥æ˜¯å¦ä¼šå½±å“æ¶ˆæ¯é¡ºåº
- æ£€æŸ¥æ˜¯å¦ä¼šå½±å“Fiberè°ƒåº¦æ—¶åº
- æ£€æŸ¥æ˜¯å¦æœ‰æ½œåœ¨çš„ç«æ€æ¡ä»¶

## ä¿®æ”¹åéªŒè¯
- éªŒè¯æ¶ˆæ¯é¡ºåºæ˜¯å¦å—å½±å“ï¼Œç¡®ä¿ä¸ä¼šå¯¼è‡´æ¶ˆæ¯ä¹±åº
- éªŒè¯Fiberçš„åˆ›å»ºã€åˆå§‹åŒ–å’Œæ¶ˆæ¯å¤„ç†çš„æ—¶åºæ˜¯å¦æ­£ç¡®
- éªŒè¯èµ„æºæ˜¯å¦æ­£ç¡®é‡Šæ”¾ï¼Œé¿å…å†…å­˜æ³„æ¼
- éªŒè¯å¼‚å¸¸å¤„ç†æ˜¯å¦å®Œæ•´ï¼Œé¿å…ç¨‹åºå´©æºƒ
- é¿å…ä»£ç å†—ä½™

# Entityç³»ç»Ÿå’Œäº‹ä»¶ç³»ç»Ÿæ¶æ„ï¼ˆæ ¸å¿ƒï¼‰

## ä¸‰å¥—ç‹¬ç«‹çš„äº‹ä»¶/è°ƒç”¨ç³»ç»Ÿ

ETæ¡†æ¶ä½¿ç”¨ä¸‰å¥—å®Œå…¨ç‹¬ç«‹çš„ç³»ç»Ÿï¼Œå„æœ‰ä¸åŒçš„ç”¨é€”å’Œç‰¹ç‚¹ï¼Œä¸èƒ½æ··ç”¨ï¼š

### 1. EventSystem.Publish/PublishAsyncï¼ˆSceneçº§å…¨å±€äº‹ä»¶ï¼‰
- **æ³¨å†Œä½ç½®**ï¼š`GameRegister.RegisterEvent()`
- **å­˜å‚¨ç»“æ„**ï¼š`_allEventDic: Dictionary<Type, List<EventInfo>>`
- **ç”¨é€”**ï¼šè·¨æ¨¡å—çš„åœºæ™¯çº§äº‹ä»¶ï¼ˆLoginFinishã€EnterMapFinishã€AfterUnitCreateç­‰ï¼‰
- **PublishAsync**ï¼šçœŸæ­£çš„å¼‚æ­¥ï¼Œ`await ETTaskHelper.WaitAll(list)` ç­‰å¾…æ‰€æœ‰å¤„ç†å™¨å®Œæˆ
- **Publish**ï¼šå‘èµ·å¼‚æ­¥ä½†ä¸ç­‰å¾…ï¼ˆ`.NoContext()`ï¼‰ï¼Œfire-and-forgetæ¨¡å¼
- **ç‰¹ç‚¹**ï¼šå¯ä»¥æ²¡æœ‰è®¢é˜…è€…ï¼ˆäº‹ä»¶è¯­ä¹‰ï¼‰ï¼ŒæŸ¥æ‰¾å¤±è´¥é™é»˜è¿”å›

### 2. EntitySystem.Publishï¼ˆâš¡æ¯å¸§çƒ­è·¯å¾„ï¼‰
- **æ³¨å†Œä½ç½®**ï¼š`Entity.RegisterSystem()` â†’ `Fiber.EntitySystem.RegisterSystem()`
- **å­˜å‚¨ç»“æ„**ï¼š`queues: Dictionary<Type, Queue<EntityRef<Entity>>>`
- **ç”¨é€”**ï¼šEntityç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆUpdateEventã€LateUpdateEventï¼‰
- **è°ƒç”¨æ—¶æœº**ï¼š`Fiber.Update()` å’Œ `Fiber.LateUpdate()` æ¯å¸§è°ƒç”¨
- **ç‰¹ç‚¹**ï¼šå®Œå…¨åŒæ­¥æ‰§è¡Œï¼Œé«˜é¢‘çƒ­è·¯å¾„ï¼Œæ€§èƒ½å…³é”®
- **é‡è¦**ï¼šä¸æ˜¯æ‰€æœ‰Entityéƒ½å®ç°IClassEvent<T>æ¥å£ï¼Œåªæœ‰éœ€è¦çš„ç»„ä»¶æ‰å®ç°ï¼ˆå¦‚IUpdateã€ILateUpdateï¼‰

### 3. EventSystem.Invokeï¼ˆå‡½æ•°å¼æ¡ä»¶è°ƒç”¨ï¼‰
- **æ³¨å†Œä½ç½®**ï¼š`GameRegister.RegisterInvoke()`
- **å­˜å‚¨ç»“æ„**ï¼š`_allInvokeDic: Dictionary<Type, Dictionary<long, IInvoke>>`
- **ç”¨é€”**ï¼šæ¡ä»¶åˆ†å‘ï¼ˆTimerå›è°ƒã€MailBoxæ¶ˆæ¯ã€FiberInitã€ç½‘ç»œè¯»å–ç­‰ï¼‰
- **ç‰¹ç‚¹**ï¼šå¿…é¡»æœ‰å¤„ç†å™¨ï¼Œå¦åˆ™æŠ›å¼‚å¸¸ï¼ˆå‡½æ•°è¯­ä¹‰ï¼‰
- **æ³¨æ„**ï¼šä¸è¦æ»¥ç”¨Invokeï¼Œèƒ½ç”¨å‡½æ•°å°±ç”¨å‡½æ•°

## Entityç”Ÿå‘½å‘¨æœŸå’Œç³»ç»Ÿæ³¨å†Œæµç¨‹

### Entityåˆ›å»ºæµç¨‹
```
1. Entityåˆ›å»ºï¼ˆé€šè¿‡EntityObjectPoolæˆ–newï¼‰
   â†’ è®¾ç½® TypeId = TypeId<T>.Idï¼ˆå…¨å±€å”¯ä¸€è¿è¡Œæ—¶IDï¼‰
   
2. Entity.RegisterSystem()
   â†’ EntitySystemSingleton.TypeSystems.GetOneTypeSystems(type)
   â†’ è·å– ClassType åˆ—è¡¨ï¼ˆå¦‚ AClassEventSystem<UpdateEvent>ï¼‰
   â†’ å°†EntityåŠ å…¥Fiber.EntitySystemå¯¹åº”é˜Ÿåˆ—
```

### Entityæ¯å¸§æ›´æ–°æµç¨‹
```
Fiber.Update()
  â†’ EntitySystem.Publish(new UpdateEvent())
  â†’ GetQueue(AClassEventSystem<UpdateEvent>)
  â†’ éå†é˜Ÿåˆ—ä¸­æ‰€æœ‰Entity
  â†’ å¯¹æ¯ä¸ªEntityï¼š
     â†’ æ£€æŸ¥ IsDisposed
     â†’ ç¼“å­˜ GetType() ç»“æœ
     â†’ TypeSystems.GetSystems(entityType, systemType)
     â†’ æ‰§è¡Œæ‰€æœ‰UpdateSystemçš„Runæ–¹æ³•
```

### Entityé”€æ¯æµç¨‹
```
Entity.Dispose()
  â†’ æ¸…ç† children å’Œ componentsï¼ˆä¼˜åŒ–ï¼šä½¿ç”¨æ•°ç»„é¿å…ä¸´æ—¶Listï¼‰
  â†’ EntitySystemSingleton.Instance.Destroy(this)
     â†’ TypeSystems.GetSystems(entityType, IDestroySystem)
     â†’ æ‰§è¡Œæ‰€æœ‰DestroySystem
```

## TypeSystems å·¥ä½œåŸç†

### æ•°æ®ç»“æ„
```
TypeSystems
  â”œâ”€ typeSystemsMap: Dictionary<Type, OneTypeSystems>
  â”‚    â””â”€ OneTypeSystems
  â”‚         â”œâ”€ Map: UnOrderMultiMap<Type, SystemObject>  // systemType â†’ List<SystemObject>
  â”‚         â”œâ”€ ClassType: List<Type>                      // IClassEventç³»ç»Ÿç±»å‹åˆ—è¡¨
  â”‚         â””â”€ Capabilities: SystemFlags                  // ğŸ”¥ æ–°å¢ï¼šèƒ½åŠ›ä½æ ‡è®°
```

### RegisterEntitySystem æ³¨å†Œæµç¨‹
```
GameRegister.RegisterEntitySystem()
  â†’ EntitySystemSingleton.RegisterEntitySystem<UpdateSystem<OperaComponent>>()
  â†’ TypeSystems.GetOrCreateOneTypeSystems(typeof(OperaComponent))
  â†’ oneTypeSystems.Map.Add(typeof(AClassEventSystem<UpdateEvent>), systemObject)
  â†’ ğŸ”¥ SetSystemCapability(oneTypeSystems, obj)  // ä½¿ç”¨æ ‡è®°æ¥å£è®¾ç½®ä½æ ‡è®°
  â”‚   â””â”€ if (obj is IAwakeSystemMarker) Capabilities |= SystemFlags.Awake
  â”‚   â””â”€ if (obj is IDestroySystemMarker) Capabilities |= SystemFlags.Destroy
  â”‚   â””â”€ if (obj is AClassEventSystem<UpdateEvent>) Capabilities |= SystemFlags.Update
  â””â”€ oneTypeSystems.ClassType.Add(typeof(AClassEventSystem<UpdateEvent>))
```

## IClassEvent æ¥å£ç†è§£ï¼ˆé‡è¦ï¼‰

### å…³é”®è®¤è¯†
- **ä¸æ˜¯æ‰€æœ‰Entityéƒ½å®ç°IClassEvent<T>**
- åªæœ‰éœ€è¦æ¥æ”¶ç‰¹å®šäº‹ä»¶çš„Entityæ‰å®ç°
- ä¾‹å¦‚ï¼šIUpdateã€ILateUpdate ç­‰

### å®ç°ç¤ºä¾‹
- `TimerComponent: Entity, IAwake, IUpdate`
- `OperaComponent: Entity, IAwake<Scene>, IUpdate`
- `NetComponent: Entity, IAwake<IKcpTransport>, IDestroy, IUpdate`
- `ProcessInnerSender: Entity, IAwake, IDestroy, IUpdate`

## TypeId vs Type

### TypeId ç‰¹ç‚¹
- **å®šä¹‰**ï¼š`TypeId<T>.Id` æ˜¯å…¨å±€å”¯ä¸€çš„è¿è¡Œæ—¶ long å€¼
- **ç”Ÿæˆ**ï¼šé€šè¿‡ `Interlocked.Increment` åŸå­é€’å¢ç”Ÿæˆ
- **ç”¨é€”**ï¼šEntityçš„ç±»å‹æ ‡è¯†ï¼Œç”¨äºç»„ä»¶æŸ¥æ‰¾ï¼ˆcomponentså­—å…¸çš„keyï¼‰ã€å¯¹è±¡æ± åˆ†ç»„ç­‰
- **æ€§èƒ½**ï¼šlongå€¼æ¯”è¾ƒæ¯”Typeå¯¹è±¡æ¯”è¾ƒå¿«

### å¯¹è±¡æ± å’Œèµ„æºç®¡ç†
- **usingè¯­å¥å’Œæ‰‹åŠ¨å›æ”¶ä¸èƒ½åŒæ—¶ä½¿ç”¨**ï¼šä¼šé€ æˆåŒé‡å›æ”¶
- **ä½¿ç”¨finallyç¡®ä¿å›æ”¶**ï¼šåœ¨å¼‚æ­¥æ–¹æ³•ä¸­ç¡®ä¿å¯¹è±¡æ± å¯¹è±¡æ­£ç¡®å›æ”¶
- **é¿å…åœ¨Disposeä¸­åˆ›å»ºä¸´æ—¶å¯¹è±¡**ï¼šç›´æ¥æ“ä½œé›†åˆï¼Œå‡å°‘GC

### é¿å…è¿‡åº¦ä¼˜åŒ–
- **å­—å…¸æŸ¥è¯¢å·²ç»å¾ˆå¿«**ï¼šä¸éœ€è¦é¢å¤–ç¼“å­˜æ¥ä¼˜åŒ–å­—å…¸æŸ¥è¯¢æœ¬èº«
- **ç®€æ´ä¼˜äºå¤æ‚**ï¼šé™¤éæœ‰æ˜ç¡®æ€§èƒ½é—®é¢˜ï¼Œä¿æŒä»£ç ç®€æ´
- **ä¼˜å…ˆä¼˜åŒ–ç®—æ³•å¤æ‚åº¦**ï¼šO(n)â†’O(1)ï¼Œè€Œä¸æ˜¯å¸¸æ•°ä¼˜åŒ–

# å¸¸è§é—®é¢˜æ³¨æ„äº‹é¡¹

## Entityç³»ç»Ÿ
- Entityçš„åˆ›å»ºå’Œé”€æ¯è¦éµå¾ªæ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸ
- ä½¿ç”¨EntitySystemçš„[EntitySystem]ç‰¹æ€§æ ‡è®°ç³»ç»Ÿæ–¹æ³•
- Componentçš„Awakeå’ŒDestroyè¦æ­£ç¡®é…å¯¹
- ç†è§£IClassEvent<T>æ¥å£ï¼Œä¸æ˜¯æ‰€æœ‰Entityéƒ½å®ç°ï¼Œåªæœ‰éœ€è¦çš„ç»„ä»¶æ‰å®ç°

## ç½‘ç»œç›¸å…³
- ç½‘ç»œè¿æ¥è¦æ­£ç¡®å¤„ç†è¶…æ—¶å’Œé‡è¿
- Sessionçš„åˆ›å»ºå’Œé”€æ¯è¦æ­£ç¡®ç®¡ç†
- ç½‘ç»œæ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¦ä½¿ç”¨Ninoåº“

## æ—¥å¿—å’Œè°ƒè¯•
- ä½¿ç”¨Log.Infoã€Log.Warningã€Log.Errorè®°å½•æ—¥å¿—
- é‡è¦æ“ä½œè¦æœ‰æ—¥å¿—è®°å½•ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
- ç”Ÿäº§ç¯å¢ƒè¦æ§åˆ¶æ—¥å¿—çº§åˆ«ï¼Œé¿å…æ—¥å¿—è¿‡å¤šå½±å“æ€§èƒ½

---

## SystemFlagsä½æ ‡è®°ç³»ç»Ÿ

### æ ¸å¿ƒè®¾è®¡

```csharp
// ä½æ ‡è®°æšä¸¾ï¼ˆæŒ‰Entityç±»å‹å­˜å‚¨åœ¨TypeSystems.OneTypeSystemsä¸­ï¼‰
[Flags]
public enum SystemFlags : byte
{
    None = 0, Awake = 1, Update = 2, LateUpdate = 4, Destroy = 8
}

// å­˜å‚¨ä½ç½®ï¼šTypeSystems.OneTypeSystems.Capabilities
// è®¾ç½®æ—¶æœºï¼šRegisterEntitySystemæ—¶ï¼Œé€šè¿‡æ ‡è®°æ¥å£åˆ¤æ–­
```

**ä½œç”¨**ï¼š
- Awake/Destroyä¸­å¿«é€Ÿè¯†åˆ«"æ²¡æœ‰Systemçš„Entity"ï¼Œé¿å…æ— æ•ˆæŸ¥è¯¢
- Publishä¸­ä¸éœ€è¦ä½æ ‡è®°æ£€æŸ¥ï¼ˆé˜Ÿåˆ—æœºåˆ¶å·²ä¿è¯ç±»å‹æ­£ç¡®ï¼‰

## æ ‡è®°æ¥å£æ¨¡å¼ï¼ˆåˆ¤æ–­Systemç±»å‹ï¼‰

```csharp
// IAwakeSystemæ ‡è®°æ¥å£ï¼ˆè¦†ç›–5ä¸ªæ³›å‹å˜ä½“ï¼‰
public interface IAwakeSystemMarker { }
public interface IAwakeSystem: ISystemType, IAwakeSystemMarker { }
public interface IAwakeSystem<A>: ISystemType, IAwakeSystemMarker { }
// ... å…¶ä»–é‡è½½åŒæ ·ç»§æ‰¿

// IDestroySystemæ ‡è®°æ¥å£
public interface IDestroySystemMarker { }
public interface IDestroySystem: ISystemType, IDestroySystemMarker { }

// è®¾ç½®èƒ½åŠ›ä½æ ‡è®°
if (obj is IAwakeSystemMarker) Capabilities |= SystemFlags.Awake;
if (obj is IDestroySystemMarker) Capabilities |= SystemFlags.Destroy;
if (obj is AClassEventSystem<UpdateEvent>) Capabilities |= SystemFlags.Update;
```

## SystemBaseç»Ÿä¸€æ³›å‹åŸºç±»

```csharp
// SystemBaseè‡ªåŠ¨å®ç°ISystemTypeï¼Œæ‰€æœ‰SystemæŠ½è±¡ç±»ç»§æ‰¿å®ƒ
public abstract class SystemBase<TEntity, TSystem> : SystemObject, ISystemType
    where TEntity : Entity, where TSystem : ISystemType
{
    Type ISystemType.Type() => typeof(TEntity);
    Type ISystemType.SystemType() => typeof(TSystem);
}

// ç¤ºä¾‹ï¼šAwakeSystemç®€åŒ–ï¼ˆä»30è¡Œâ†’8è¡Œï¼Œå‡å°‘73%ï¼‰
public abstract class AwakeSystem<T> : SystemBase<T, IAwakeSystem>, IAwakeSystem 
    where T: Entity, IAwake
{
    void IAwakeSystem.Run(Entity o) => this.Awake((T)o);
    protected abstract void Awake(T self);
}
```

## ä½¿ç”¨æŒ‡å—

### Entityå®šä¹‰ï¼ˆModelå±‚ï¼‰
```csharp
[ComponentOf(typeof(Scene))]
public class TimerComponent: Entity, IAwake, IUpdate { }
```

### Systemå®ç°ï¼ˆHotfixå±‚ï¼‰
```csharp
[EntitySystemOf(typeof(TimerComponent))]
public static partial class TimerComponentSystem
{
    [EntitySystem] private static void Awake(this TimerComponent self) { }
    [EntitySystem] private static void Update(this TimerComponent self) { }
}
```
